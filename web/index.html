<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StopAddict — Suivi conso</title>
  <!-- (Optionnel) ton CSS projet si présent -->
  <link rel="stylesheet" href="./css/style.css" />
  <style>
    /* Garde-fous visuels minimaux pour que tout fonctionne même sans style.css */
    :root { --bg:#0b1220; --panel:#0e1729; --card:#111a2e; --text:#e5e7eb; --muted:#9ca3af; }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font:500 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:12px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 1px 2px rgba(0,0,0,.3)}
    .hide{display:none}
    header.top{background:var(--panel);padding:12px 0;border-bottom:1px solid rgba(255,255,255,.05)}
    header.top .row{align-items:center;justify-content:space-between}
    #app-title{margin:0;font-size:22px}
    #today-date{cursor:pointer;opacity:.9}
    .summary{display:flex;gap:14px;flex-wrap:wrap}
    .summary .pill{background:#1a2642;border-radius:999px;padding:6px 10px;font-size:14px}
    .summary .status{width:22px;height:22px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:#1f2b48}
    nav#tabs{background:#0c162d;border-bottom:1px solid rgba(255,255,255,.06)}
    nav#tabs .wrap{display:flex;gap:8px}
    .tab{background:#13203c;border:1px solid rgba(255,255,255,.06);color:var(--text);padding:8px 12px;border-radius:8px;cursor:pointer}
    .tab.active{background:#1a2a50}
    main .page{padding:16px 0}
    .counter{flex:1 1 280px}
    .counter h3{margin:0 0 8px 0}
    .actions{display:flex;align-items:center;gap:8px}
    .actions button{min-width:36px;height:36px;border-radius:8px;border:1px solid rgba(255,255,255,.12);background:#0f1b34;color:var(--text);cursor:pointer}
    .actions .val{min-width:36px;text-align:center;font-weight:700}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .section-title{margin:8px 0 12px 0;font-size:18px}
    .field{display:grid;gap:6px}
    .field input,.field select,.field button{height:36px;border-radius:8px;border:1px solid rgba(255,255,255,.12);background:#0f1b34;color:var(--text);padding:0 10px}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .chart-wrap{min-height:320px}
    dialog.modal{border:none;border-radius:12px;max-width:520px;width:92%;padding:18px;background:#101a31;color:var(--text)}
    #debug-console{position:fixed;inset:auto 12px 12px 12px;max-height:30vh;overflow:auto;background:#0b1327;border:1px dashed #31406f;border-radius:10px;padding:8px;font:12px/1.35 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono'}
    .debug-line{padding:2px 0;border-bottom:1px dotted rgba(255,255,255,.05)}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- ===================== Topbar ===================== -->
  <header class="top">
    <div class="wrap">
      <div class="row">
        <h1 id="app-title">StopAddict</h1>
        <div class="summary">
          <span class="pill">Clopes : <strong id="hdr-cigs">0</strong></span>
          <span class="pill">Joints : <strong id="hdr-joints">0</strong></span>
          <span class="pill">Alcool : <strong id="hdr-alcohol">0</strong></span>
          <span class="pill">Coût : <strong id="hdr-cost">0,00€</strong></span>
          <span class="pill">Économies : <strong id="hdr-saved">0,00€</strong></span>
          <span class="status" id="hdr-status">•</span>
          <span id="today-date" title="5 tapes rapides = console debug">—/—/—</span>
        </div>
      </div>
    </div>
  </header>

  <!-- ===================== Tabs ===================== -->
  <nav id="tabs">
    <div class="wrap">
      <button class="tab active" data-tab="home">Accueil</button>
      <button class="tab" data-tab="stats">Stats</button>
      <button class="tab" data-tab="calendar">Calendrier</button>
      <button class="tab" data-tab="habits">Habitudes</button>
      <button class="tab" data-tab="settings">Réglages</button>
    </div>
  </nav>

  <main class="wrap">
    <!-- ===================== HOME ===================== -->
    <section id="page-home" class="page">
      <div class="card">
        <div class="section-title">Aujourd'hui</div>
        <p class="muted">Renseigne les prix dans Réglages pour voir des coûts/économies réalistes. Un pas de moins réduit la note dès aujourd'hui.</p>
      </div>

      <div class="row">
        <!-- cigs -->
        <div class="card counter" id="ctr-cigs">
          <h3>Cigarettes</h3>
          <div class="actions">
            <button data-action="dec" data-kind="cigs">−</button>
            <div class="val" id="val-cigs">0</div>
            <button data-action="inc" data-kind="cigs">+</button>
          </div>
          <label><input type="checkbox" id="chk-cigs-active" checked> Activer</label>
        </div>
        <!-- joints -->
        <div class="card counter" id="ctr-joints">
          <h3>Joints</h3>
          <div class="actions">
            <button data-action="dec" data-kind="joints">−</button>
            <div class="val" id="val-joints">0</div>
            <button data-action="inc" data-kind="joints">+</button>
          </div>
          <label><input type="checkbox" id="chk-joints-active" checked> Activer</label>
        </div>
        <!-- beer -->
        <div class="card counter" id="ctr-beer">
          <h3>Bière</h3>
          <div class="actions">
            <button data-action="dec" data-kind="beer">−</button>
            <div class="val" id="val-beer">0</div>
            <button data-action="inc" data-kind="beer">+</button>
          </div>
          <label><input type="checkbox" id="chk-beer-active" checked> Activer</label>
        </div>
        <!-- hard -->
        <div class="card counter" id="ctr-hard">
          <h3>Alcool fort</h3>
          <div class="actions">
            <button data-action="dec" data-kind="hard">−</button>
            <div class="val" id="val-hard">0</div>
            <button data-action="inc" data-kind="hard">+</button>
          </div>
          <label><input type="checkbox" id="chk-hard-active" checked> Activer</label>
        </div>
        <!-- liqueur -->
        <div class="card counter" id="ctr-liqueur">
          <h3>Liqueur</h3>
          <div class="actions">
            <button data-action="dec" data-kind="liqueur">−</button>
            <div class="val" id="val-liqueur">0</div>
            <button data-action="inc" data-kind="liqueur">+</button>
          </div>
          <label><input type="checkbox" id="chk-liqueur-active" checked> Activer</label>
        </div>
      </div>
    </section>

    <!-- ===================== STATS ===================== -->
    <section id="page-stats" class="page hide">
      <div class="card">
        <div class="toolbar">
          <strong>Bilan — <span id="stats-date">Aujourd'hui</span></strong>
          <span style="flex:1"></span>
          <button id="btnPeriod-day">Jour</button>
          <button id="btnPeriod-week">Semaine</button>
          <button id="btnPeriod-month">Mois</button>
          <button id="btnPeriod-year">Année</button>
        </div>
        <div class="chart-wrap" style="margin-top:10px">
          <canvas id="chart-main"></canvas>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="toolbar">
          <strong>Export / Import</strong>
          <label style="margin-left:auto"></label>
          <button id="btn-export-csv">Exporter CSV</button>
          <button id="btn-export-json">Exporter TOUT (JSON)</button>
          <label class="field" style="max-width:260px">
            <span>Importer JSON</span>
            <input type="file" id="file-import-json" accept="application/json" />
          </label>
        </div>
      </div>
    </section>

    <!-- ===================== CALENDAR ===================== -->
    <section id="page-calendar" class="page hide">
      <div id="calendar-root" class="card">Calendrier</div>
    </section>

    <!-- ===================== HABITS ===================== -->
    <section id="page-habits" class="page hide">
      <div class="card">
        <div class="section-title">Objectifs quotidiens</div>
        <div class="grid3">
          <label class="field">Cigarettes / jour<input type="number" id="goal-cigs" min="0" value="0"></label>
          <label class="field">Joints / jour<input type="number" id="goal-joints" min="0" value="0"></label>
          <label class="field">Bière / jour<input type="number" id="goal-beer" min="0" value="0"></label>
          <label class="field">Alcool fort / jour<input type="number" id="goal-hard" min="0" value="0"></label>
          <label class="field">Liqueur / jour<input type="number" id="goal-liqueur" min="0" value="0"></label>
        </div>
        <div class="toolbar" style="margin-top:10px">
          <button id="btn-habits-save">Enregistrer</button>
          <button id="btn-habits-reset">Réinitialiser</button>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="section-title">Dates clés</div>
        <div class="grid3">
          <label class="field">Arrêt global<input type="date" id="date-stop-global"></label>
          <label class="field">Arrêt alcool<input type="date" id="date-stop-alcohol"></label>
          <label class="field">Arrêt cigarettes<input type="date" id="date-stop-cigs"></label>
          <label class="field">Arrêt joints<input type="date" id="date-stop-joints"></label>

          <label class="field">Clope — Début réduction<input type="date" id="date-reduce-cigs"></label>
          <label class="field">Clope — Objectif d'arrêt<input type="date" id="date-quit-cigs-obj"></label>
          <label class="field">Clope — Plus censé fumer<input type="date" id="date-nomore-cigs"></label>

          <label class="field">Joints — Début réduction<input type="date" id="date-reduce-joints"></label>
          <label class="field">Joints — Objectif d'arrêt<input type="date" id="date-quit-joints-obj"></label>
          <label class="field">Joints — Plus censé fumer<input type="date" id="date-nomore-joints"></label>

          <label class="field">Alcool — Début réduction<input type="date" id="date-reduce-alcohol"></label>
          <label class="field">Alcool — Objectif d'arrêt<input type="date" id="date-quit-alcohol-obj"></label>
          <label class="field">Alcool — Plus censé boire<input type="date" id="date-nomore-alcohol"></label>
        </div>
      </div>
    </section>

    <!-- ===================== SETTINGS ===================== -->
    <section id="page-settings" class="page hide">
      <!-- Profil & langue -->
      <div class="card">
        <div class="grid3">
          <label class="field">Prénom (facultatif)
            <input type="text" id="profile-name" placeholder="Ex. Nico" />
          </label>
          <label class="field">Langue
            <select id="select-language"></select>
          </label>
        </div>
      </div>

      <!-- Devise -->
      <div class="card" style="margin-top:12px">
        <div class="section-title">Devise (affichage)</div>
        <div class="grid3">
          <label class="field">Symbole
            <input id="currency-symbol" value="€" />
          </label>
          <label class="field">Position
            <div class="row"><label><input type="radio" name="curpos" id="currency-before" checked> Avant</label>
              <label><input type="radio" name="curpos" id="currency-after"> Après</label>
            </div>
          </label>
          <label class="field">Actions
            <button id="btn-apply-currency">Appliquer</button>
          </label>
        </div>
      </div>

      <!-- Modules -->
      <div class="card" style="margin-top:12px">
        <div class="section-title">Modules</div>
        <div class="grid3">
          <label><input type="checkbox" id="mod-cigs" checked> Cigarettes</label>
          <label><input type="checkbox" id="mod-joints" checked> Joints</label>
          <label><input type="checkbox" id="mod-beer" checked> Bière</label>
          <label><input type="checkbox" id="mod-hard" checked> Alcool fort</label>
          <label><input type="checkbox" id="mod-liqueur" checked> Liqueur</label>
          <label><input type="checkbox" id="mod-alcohol"> Alcool (global)</label>
        </div>
      </div>

      <!-- Prix unitaires & variantes basiques -->
      <div class="card" style="margin-top:12px">
        <div class="section-title">Prix unitaires</div>
        <div class="grid3">
          <label class="field">Cigarette — prix / unité<input type="number" step="0.01" id="price-cigarette" value="0"></label>
          <label class="field">Joint — prix / unité<input type="number" step="0.01" id="price-joint" value="0"></label>
          <label class="field">Bière — prix / unité<input type="number" step="0.01" id="price-beer" value="0"></label>
          <label class="field">Alcool fort — prix / dose<input type="number" step="0.01" id="price-hard" value="0"></label>
          <label class="field">Liqueur — prix / dose<input type="number" step="0.01" id="price-liqueur" value="0"></label>
        </div>
        <div class="toolbar" style="margin-top:10px">
          <button id="btn-save-prices">Enregistrer</button>
          <button id="btn-reset-prices">Réinitialiser prix</button>
        </div>
      </div>

      <!-- RAZ & sauvegardes -->
      <div class="card" style="margin-top:12px">
        <div class="section-title">RAZ & sauvegarde</div>
        <div class="toolbar">
          <button id="btn-raz-day">RAZ du jour</button>
          <button id="btn-raz-history">RAZ historique (conso)</button>
          <button id="btn-raz-factory">RAZ réglages (usine)</button>
          <span style="flex:1"></span>
          <button id="btn-save-json-settings">Sauvegarder JSON</button>
          <label class="field" style="max-width:260px">
            <span>Importer JSON (réglages + état)</span>
            <input type="file" id="file-import-json-settings" accept="application/json"/>
          </label>
        </div>
      </div>

      <!-- Journal & Debug -->
      <div class="card" style="margin-top:12px">
        <div class="section-title">Journal & DEBUG</div>
        <div class="toolbar">
          <label><input type="checkbox" id="cb-debug-overlay"> Overlay DEBUG (afficher)</label>
          <button id="btn-copy-logs">Copier les logs</button>
          <button id="btn-clear-logs">Vider les logs</button>
          <span style="flex:1"></span>
          <button id="btn-resources">Ressources & numéros utiles</button>
        </div>
      </div>
    </section>
  </main>

  <!-- ===================== Age-gate ===================== -->
  <dialog id="agegate" class="modal">
    <h3>Avertissement</h3>
    <p>Cette application est destinée aux majeurs. En poursuivant, vous confirmez avoir 18 ans ou plus.</p>
    <p>
      <label><input type="checkbox" id="age-18plus"> J'ai 18 ans ou plus</label><br>
      <label><input type="checkbox" id="age-hide"> Ne plus afficher ce message</label>
    </p>
    <div class="toolbar">
      <button id="btn-age-accept" disabled>J'accepte et continuer</button>
    </div>
  </dialog>

  <!-- Console debug (toggleable via case dans Réglages ou 5 taps sur la date) -->
  <div id="debug-console" class="hide"></div>

  <!-- App (ES modules) -->
  <script type="module" src="./js/app.js"></script>
</body>
</html>
