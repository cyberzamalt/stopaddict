<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>StopAddict</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="stylesheet" href="./css/app.css" />
</head>
<body>
  <a href="#main" class="sr-only skip">Aller au contenu</a>

  <main id="main">
    <header class="app-header">
      <h1>StopAddict</h1>
      <div class="header-stats">
        <div><strong>Aujourd’hui</strong><span id="todayTotal">—</span></div>
        <div><strong>Semaine</strong><span id="weekTotal">—</span></div>
        <div><strong>Mois</strong><span id="monthTotal">—</span></div>
        <div><strong>Coût jour</strong><span id="todayCost">—</span></div>
      </div>
    </header>

    <section class="card">
      <h2>Activer ce que tu suis</h2>
      <div class="row">
        <label><input type="checkbox" id="enableCigs"> Je fume</label>
        <label><input type="checkbox" id="enableWeed"> Je fume des joints</label>
        <label><input type="checkbox" id="enableAlcohol"> Je bois</label>
      </div>
      <p class="muted small">Tu peux tout changer quand tu veux. Les modules non activés n’apparaissent pas.</p>
    </section>

    <section id="cardCigs" class="card hide">
      <h2>Clopes <span class="pill" id="cigsToday">0</span></h2>
      <div class="row">
        <button class="btn minus" data-type="cig">−</button>
        <button class="btn plus"  data-type="cig">+</button>
      </div>
      <p class="limit" id="limitCigs"></p>
      <p class="alert hide" id="alertCigs"></p>
    </section>

    <section id="cardWeed" class="card hide">
      <h2>Pétards <span class="pill" id="weedToday">0</span></h2>
      <div class="row">
        <button class="btn minus" data-type="weed">−</button>
        <button class="btn plus"  data-type="weed">+</button>
      </div>
      <p class="limit" id="limitWeed"></p>
      <p class="alert hide" id="alertWeed"></p>
    </section>

    <section id="cardAlcohol" class="card hide">
      <h2>Alcool <span class="pill" id="alcoToday">0</span></h2>
      <div class="row">
        <button class="btn minus" data-type="beer">Bière −</button>
        <button class="btn plus"  data-type="beer">Bière +</button>
        <button class="btn minus" data-type="strong">Alcool fort −</button>
        <button class="btn plus"  data-type="strong">Alcool fort +</button>
        <button class="btn minus" data-type="liquor">Liqueur −</button>
        <button class="btn plus"  data-type="liquor">Liqueur +</button>
      </div>
      <p class="limit" id="limitAlcohol"></p>
      <p class="alert hide" id="alertAlcohol"></p>
    </section>

    <section class="card">
      <h2>Statistiques</h2>
      <div class="row" id="chartRange">
        <button class="btn pill active" data-range="day">Jour</button>
        <button class="btn pill" data-range="week">Semaine</button>
        <button class="btn pill" data-range="month">Mois</button>
      </div>
      <div class="chart-wrap">
        <canvas id="chartCanvas" width="900" height="280"></canvas>
      </div>
      <p class="muted small" id="chartHint">Basé sur tes entrées (tous types confondus). Ligne orange : limite/jour si définie.</p>
    </section>

    <section class="card">
      <h2>Calendrier</h2>
      <div class="cal-head">
        <button id="calPrev" class="btn">◀</button>
        <div id="calTitle"></div>
        <button id="calNext" class="btn">▶</button>
      </div>
      <div class="cal-grid cal-weekdays">
        <div>Lun</div><div>Mar</div><div>Mer</div><div>Jeu</div><div>Ven</div><div>Sam</div><div>Dim</div>
      </div>
      <div id="calGrid" class="cal-grid cal-days"></div>

      <div id="calEditor" class="cal-editor hide">
        <div class="cal-editor-head">
          <strong id="calEditDate">—</strong>
          <button id="calClose" class="btn">Fermer</button>
        </div>
        <div class="row" id="calEditButtons"></div>
        <p class="muted small">Ajuste la journée sélectionnée. “+” ajoute une entrée datée ce jour, “−” retire la dernière entrée (par type).</p>
      </div>
    </section>

    <section class="card">
      <h2>Réglages</h2>
      <div class="grid2">
        <div>
          <h3>Prix</h3>
          <label>Prix paquet (€) <input type="number" step="0.1" id="pricePack"></label>
          <label>Clopes / paquet <input type="number" id="cigsPerPack"></label>
          <label>Prix joint (€) <input type="number" step="0.1" id="priceJoint"></label>
          <label>Prix bière (€) <input type="number" step="0.1" id="priceBeer"></label>
          <label>Prix alcool fort (€) <input type="number" step="0.1" id="priceStrong"></label>
          <label>Prix liqueur (€) <input type="number" step="0.1" id="priceLiquor"></label>
        </div>
        <div>
          <h3>Limites / jour</h3>
          <label>Clopes <input type="number" id="limitDayCigs"></label>
          <label>Joints <input type="number" id="limitDayWeed"></label>
          <label>Verres (total) <input type="number" id="limitDayAlcohol"></label>

          <h3 style="margin-top:.75rem">Objectifs (baseline manuelle / jour)</h3>
          <label>Clopes <input type="number" id="goalCigs" placeholder="ex. 5"></label>
          <label>Joints <input type="number" id="goalWeed" placeholder="ex. 0"></label>
          <label>Verres <input type="number" id="goalAlcohol" placeholder="ex. 2"></label>
          <label><input type="checkbox" id="baselineAuto" checked> Baseline auto si objectifs vides (moy. 30j)</label>

          <p class="muted small">Les économies sont calculées à partir de la baseline (objectifs ou moyenne 30j). Jamais d’économie négative.</p>
        </div>
      </div>
      <div class="row">
        <button id="btnSaveSettings" class="btn primary">Enregistrer</button>
      </div>
    </section>

    <section class="card">
      <h2>Import / Export</h2>
      <div class="row">
        <button id="btnImport" class="btn">Importer JSON</button>
        <input id="fileJson" type="file" accept="application/json" hidden />
        <button id="btnExport" class="btn">Exporter CSV</button>
        <button id="btnExportJson" class="btn">Exporter JSON</button>
        <button id="btnClearAll" class="btn" title="Efface toutes les données locales">Effacer toutes les données</button>
      </div>
      <p id="feedback" class="feedback" role="status" aria-live="polite"></p>
      <pre id="preview" hidden></pre>
      <p class="muted small">
        Les économies et coûts sont des estimations basées sur tes réglages et ta saisie. Elles ne reflètent pas forcément ta réalité.
      </p>
    </section>

    <!-- ====== À propos & Aide ====== -->
    <section class="card">
      <h2>À propos & Aide</h2>

      <details>
        <summary><strong>Rappels importants</strong></summary>
        <ul class="muted">
          <li>Les économies sont des <em>estimations</em> (réglages, honnêteté d’usage, habitudes de dépenses).</li>
          <li>Aucune donnée n’est envoyée : tout est stocké <strong>localement</strong> sur l’appareil.</li>
          <li>Tu peux <strong>effacer</strong> toutes les données à tout moment (Import/Export).</li>
        </ul>
      </details>

      <details>
        <summary><strong>Majorité & Avertissement</strong></summary>
        <p class="muted small">Coche si tu as l’âge légal dans ton pays :</p>
        <label><input type="checkbox" id="ageOk" /> J’atteste être majeur(e).</label>
      </details>

      <details>
        <summary><strong>Numéros d’urgence</strong></summary>
        <p class="muted small">En cas de détresse, appelle directement depuis ton téléphone.</p>
        <button id="btnEmergency" class="btn">Afficher les numéros utiles</button>
      </details>

      <details>
        <summary><strong>Besoin de réinitialiser ?</strong></summary>
        <p class="muted small">Le bouton “Effacer toutes les données” se trouve dans la section Import/Export.</p>
        <button id="btnShowEraseHint" class="btn">Y aller</button>
      </details>
    </section>
  </main>

  <!-- JS modules -->
  <script type="module" src="./js/app.js"></script>
  <script type="module" src="./js/about.js"></script>
</body>
</html>
